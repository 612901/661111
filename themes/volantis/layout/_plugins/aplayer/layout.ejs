<%
let aplayer = theme.plugins.aplayer;
%>
<% if (theme.plugins.aplayer.enable == true) { %>
  <% if (aplayer.localMusic.enable == true) { // 采用本地音乐 %> 
    <% 
      let audio = aplayer.localMusic.audio; // 获取本地歌曲数组
      let template = aplayer.localMusic.template; // 获取模板
      // 使用模板补充缺少的信息
      audio.forEach((item) => {
        let name = item.name;
        if(!item.artist) item.artist = template.artist.replaceAll("{name}", name);
        if(!item.title) item.title = template.title.replaceAll("{name}", name);
        if(!item.url) item.url = template.root + template.url.replaceAll("{name}", name);
        if(!item.lrc) item.lrc = template.root + template.lrc.replaceAll("{name}", name);
        if(!item.cover) item.cover = template.root + template.cover.replaceAll("{name}", name);
      });
    %> 
    <meting-js
      theme='<%- aplayer.theme %>'
      autoplay='<%- aplayer.autoplay %>'
      volume='<%- aplayer.volume %>'
      loop='<%- aplayer.loop %>'
      order='<%- aplayer.order %>'
      fixed='<%- aplayer.fixed %>'
      list-max-height='<%- aplayer.list_max_height %>'
      server='<%- aplayer.server %>'
      type='<%- aplayer.type %>'
      id='<%- aplayer.id %>'
      list-folded='<%- aplayer.list_folded %>'
      audio= <%- encodeURI(JSON.stringify(audio)) // 采用URI编码,防止特殊字符造成的异常 %>
      >
      </meting-js>
    <% } else { %>
      <% if (post && post.music) { %>
        <meting-js
          mini='true'
          volume='<%- post.music.volume || aplayer.volume %>'
          loop='<%- post.music.loop || aplayer.loop %>'
          order='<%- post.music.order || aplayer.order %>'
          server='<%- post.music.server || aplayer.server %>'
          type='<%- post.music.type || aplayer.type %>'
          id='<%- post.music.id || aplayer.id %>'>
        </meting-js>
      <% } else { %>
        <meting-js
          theme='<%- aplayer.theme %>'
          autoplay='<%- aplayer.autoplay %>'
          volume='<%- aplayer.volume %>'
          loop='<%- aplayer.loop %>'
          order='<%- aplayer.order %>'
          fixed='<%- aplayer.fixed %>'
          list-max-height='<%- aplayer.list_max_height %>'
          server='<%- aplayer.server %>'
          type='<%- aplayer.type %>'
          id='<%- aplayer.id %>'
          list-folded='<%- aplayer.list_folded %>'>
        </meting-js>
      <% } %>
    <% } %>
<% } %> 
